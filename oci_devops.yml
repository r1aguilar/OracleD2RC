version: 0.1
component: build
timeoutInSeconds: 1200
shell: bash

env:
  variables:
    JAVA_HOME: /usr/lib64/graalvm/graalvm22-ee-java17
    IMAGE_NAME: "mx-queretaro-1.ocir.io/axgw2tdpave8/mtdr-spring"
    IMAGE_TAG: "latest"

  exportedVariables:
    - IMAGE_NAME
    - IMAGE_TAG

steps:
  - type: Command
    name: "Install GraalVM Native Image"
    command: yum -y install graalvm22-ee-17-native-image

  - type: Command
    name: "Set PATH"
    command: export PATH=$JAVA_HOME/bin:$PATH

  - type: Command
    name: "Login to OCIR"
    command: |
      echo "e6k)8n.:E6y[#L{5()jm" | docker login -u "axgw2tdpave8/a01285921@tec.mx" --password-stdin mx-queretaro-1.ocir.io

  - type: Command
    name: "Build Docker Image"
    command: |
      cd MtdrSpring/backend
      docker build -t $IMAGE_NAME:$IMAGE_TAG .

outputArtifacts:
  - name: mtdrImage
    type: DOCKER_IMAGE
    imageUri: ${IMAGE_NAME}:${IMAGE_TAG}
