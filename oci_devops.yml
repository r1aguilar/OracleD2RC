version: 0.1
component: build
timeoutInSeconds: 1800
shell: bash
failImmediatelyOnError: true

steps:
  - type: Command
    name: "Instalar GraalVM Native Image"
    command: |
      yum -y install graalvm22-ee-17-native-image

  - type: Command
    name: "Docker Login"
    command: |
      docker login mx-queretaro-1.ocir.io \
        -u "axgw2tdpave8/a01285921@tec.mx" \
        -p 'e6k)8n.:E6y[#L{5()jm'

  - type: Command
    name: "Compilar Spring Boot"
    command: |
      cd MtdrSpring
      ./mvnw -B clean package -DskipTests

  - type: Command
    name: "Construir imagen Docker"
    command: |
      cd MtdrSpring
      docker build -t mx-queretaro-1.ocir.io/axgw2tdpave8/mtdrspring:latest .

  - type: Command
    name: "Push de imagen Docker"
    command: |
      docker push mx-queretaro-1.ocir.io/axgw2tdpave8/mtdrspring:latest

outputArtifacts:
  - name: mtdrspring_image
    type: DOCKER_IMAGE
    location: mx-queretaro-1.ocir.io/axgw2tdpave8/mtdrspring:latest


      - type: Command
    name: "Undeploy"
    command: export PATH=$PATH:$HOME/k8s;kubectl version;
      export KUBECONFIG=$HOME/.kube/config;
      cd MtdrSpring;
      source env.sh;
      cd backend;
      ls -l;
      kubectl config view;
      source undeploy.sh;
