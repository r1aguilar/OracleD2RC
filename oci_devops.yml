version: 0.1
component: build
timeoutInSeconds: 600
shell: bash

env:
  variables:
    JAVA_HOME: /usr/lib64/graalvm/graalvm22-ee-java17
    PATH: /usr/lib64/graalvm/graalvm22-ee-java17/bin:$PATH

steps:
  - type: Command
    name: "Install GraalVM Native Image"
    command: yum -y install graalvm22-ee-17-native-image

  - type: Command
    name: "Docker Login & Build Image"
    command: |
      cd MtdrSpring
      oci os object get --bucket-name reacttodo-rolax --name deployment_config.tgz --file deployment_config.tgz
      tar -xzvf deployment_config.tgz
      source env.sh
      echo "e6k)8n.:E6y[#L{5()jm" | docker login -u "axgw2tdpave8/a01285921@tec.mx" --password-stdin mx-queretaro-1.ocir.io
      (cd backend && source build.sh)
      echo $DOCKER_IMAGE > ../image.txt

outputArtifacts:
  - name: deploymentArtifact
    type: BINARY
    files:
      - image.txt
